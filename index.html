<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cookie Clicker - Upgrades Edition!</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #f0e6d2, #d4c4a8);
      margin: 0;
      padding: 20px;
      user-select: none;
      color: #6b4e31;
      min-height: 100vh;
    }
    #cookie {
      width: 280px;
      height: 280px;
      margin: 20px auto;
      cursor: pointer;
      transition: transform 0.1s;
      border-radius: 50%;
      box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    }
    #cookie:active { transform: scale(0.95); }
    h1 { font-size: 2.8em; margin: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
    #score { font-size: 3em; margin: 10px; color: #d2691e; font-weight: bold; }
    #cps { font-size: 1.6em; color: #8b4513; }
    #milkMain { font-size: 1.3em; color: #4169e1; font-style: italic; }

    .container { max-width: 1400px; margin: 0 auto; }
    .upgrades, .shop { 
      display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin: 20px auto;
    }
    button {
      font-family: inherit; padding: 12px 20px; background: #8b4513; color: white;
      border: none; border-radius: 12px; cursor: pointer; transition: all 0.2s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); min-width: 160px; font-size: 16px;
    }
    button:hover:not(:disabled) { background: #a0522d; transform: translateY(-2px); }
    button:disabled { background: #ccc; cursor: not-allowed; }

    .upgrade-btn {
      background: linear-gradient(#ffd700, #ffb347);
      color: black; font-weight: bold; min-width: 200px;
    }
    .upgrade-btn:hover:not(:disabled) { background: linear-gradient(#ffea00, #ff8c00); }

    #statsBtn, #reset {
      background: #4169e1; min-width: auto; padding: 10px 20px; margin: 10px; font-size: 18px;
    }
    #reset { background: #dc143c; }
    #reset:hover { background: #b22222; }

    #statsModal, #achPopup {
      position: fixed; background: rgba(0,0,0,0.8); top: 0; left: 0; width: 100%; height: 100%;
      display: none; z-index: 1000; backdrop-filter: blur(5px); align-items: center; justify-content: center;
    }
    #statsContent {
      background: white; color: black; padding: 30px; border-radius: 20px;
      max-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.5); text-align: left;
    }
    #achPopup { display: none; }
    #achPopup.show {
      display: block !important;
      animation: fadeInOut 4s forwards;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; transform: scale(0.5); }
      15% { opacity: 1; transform: scale(1.1); }
      85% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(0.8); }
    }
    .ach-inner {
      background: linear-gradient(gold, orange); padding: 30px; border-radius: 20px;
      font-size: 28px; font-weight: bold; box-shadow: 0 0 50px gold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ultimate Cookie Clicker</h1>
    <div id="score">0 cookies</div>
    <div id="cps">0.00 cookies/second</div>
    <div id="milkMain">Milk: 0%</div>

    <img id="cookie" src="https://i.imgur.com/o3q8z3s.png" alt="Click me!">

    <div class="shop" id="upgrades"></div>
    <div class="shop" id="upgradeShop"></div>

    <button id="statsBtn">Stats</button>
    <button id="reset">Wipe Save</button>
  </div>

  <div id="statsModal">
    <div id="statsContent">
      <h3>Cookie Stats</h3>
      <p>Total baked: <span id="totalBakedDisp">0</span></p>
      <p>Hand-made: <span id="clicksDisp">0</span></p>
      <p>Achievements: <span id="achCountDisp">0</span>/<span id="totalAchDisp">0</span></p>
      <p>Milk: <span id="milkDisp">0%</span></p>
      <button onclick="document.getElementById('statsModal').style.display='none'">Close</button>
    </div>
  </div>

  <div id="achPopup"><div class="ach-inner">Achievement Get!</div></div>

  <script>
    let cookies = 0;
    let totalBaked = 0;
    let manualClicks = 0;
    let baseCps = 0;
    let cps = 0;
    let clickPower = 1;
    let lastTime = performance.now();

    const buildings = [
      {name: 'Cursor', baseCost: 15, cps: 0.1, owned: 0, id: 'cursor'},
      {name: 'Grandma', baseCost: 100, cps: 1, owned: 0, id: 'grandma'},
      {name: 'Farm', baseCost: 1100, cps: 8, owned: 0, id: 'farm'},
      {name: 'Mine', baseCost: 12000, cps: 47, owned: 0, id: 'mine'},
      {name: 'Factory', baseCost: 130000, cps: 260, owned: 0, id: 'factory'},
      {name: 'Bank', baseCost: 1400000, cps: 1400, owned: 0, id: 'bank'},
      {name: 'Temple', baseCost: 20000000, cps: 7800, owned: 0, id: 'temple'},
      {name: 'Wizard Tower', baseCost: 330000000, cps: 44000, owned: 0, id: 'wizardtower'}
    ];

    const upgrades = [
      // Cursor upgrades
      {id: 'reinforced', name: 'Reinforced Index Finger', cost: 100, effect: () => clickPower *= 2, req: () => buildings[0].owned >= 1, icon: 'Hand'},
      {id: 'carpal', name: 'Carpal Tunnel Prevention Cream', cost: 500, effect: () => clickPower *= 2, req: () => buildings[0].owned >= 1, icon: 'Hand'},
      {id: 'ambidextrous', name: 'Ambidextrous', cost: 10000, effect: () => clickPower *= 2, req: () => buildings[0].owned >= 10, icon: 'HandHand'},
      {id: 'thousand', name: 'Thousand Fingers', cost: 100000, effect: () => clickPower += buildings[0].owned * 0.1, req: () => buildings[0].owned >= 25, icon: 'HandHandHand'},
      // Grandma upgrades
      {id: 'farmer', name: 'Farmer Grandmas', cost: 1100, effect: () => buildings[1].cps *= 2, req: () => buildings[1].owned >= 15 && buildings[2].owned >= 15, icon: 'Grandma'},
      {id: 'miner', name: 'Miner Grandmas', cost: 12000, effect: () => buildings[1].cps *= 2, req: () => buildings[1].owned >= 15 && buildings[3].owned >= 15, icon: 'Grandma'},
      // Click upgrades
      {id: 'doubleclick', name: 'Double Click', cost: 5000, effect: () => clickPower *= 2, req: () => manualClicks >= 100, icon: 'Mouse'},
      {id: 'luckyday', name: 'Lucky Day', cost: 77777, effect: () => cps *= 1.1, req: () => totalBaked >= 77777, icon: 'Four Leaf Clover'},
      // Global multipliers
      {id: 'kitten1', name: 'Kitten Helpers', cost: 1000000, effect: () => {}, req: () => getMilk() >= 4, icon: 'Cat'},
      {id: 'elder', name: 'Elder Covenant', cost: 666666666, effect: () => cps *= 0.95, req: () => cps >= 1000000, icon: 'Elder'}
    ];

    const achievements = [
      {name: 'Wake and bake', condition: () => totalBaked >= 1},
      {name: 'Click', condition: () => buildings[0].owned >= 1},
      {name: 'Double-click', condition: () => clickPower >= 2},
      {name: 'Clicktastic', condition: () => manualClicks >= 1000},
      {name: 'One with everything', condition: () => buildings.every(b => b.owned >= 1)},
      {name: 'Centennial', condition: () => buildings.reduce((a,b) => a + b.owned, 0) >= 100}
    ];

    const elements = {
      cookie: document.getElementById('cookie'),
      score: document.getElementById('score'),
      cps: document.getElementById('cps'),
      milk: document.getElementById('milkMain'),
      upgradesDiv: document.getElementById('upgrades'),
      upgradeShop: document.getElementById('upgradeShop'),
      achPopup: document.getElementById('achPopup')
    };

    const SUFFIXES = ['', 'K', 'M', 'B', 'T', 'Q', 'Qi', 'Sx', 'Sp'];

    function format(num) {
      if (num < 1000) return Math.floor(num).toString();
      const tier = Math.floor(Math.log10(num) / 3);
      const scaled = num / Math.pow(1000, tier);
      return scaled.toFixed(2) + SUFFIXES[tier];
    }

    function getCost(b) { return Math.floor(b.baseCost * Math.pow(1.15, b.owned)); }

    function calcBaseCps() {
      return buildings.reduce((sum, b) => sum + b.cps * b.owned, 0);
    }

    function getMilk() {
      return achievements.filter(a => a.unlocked).length * 4;
    }

    function update() {
      const milkPct = getMilk();
      baseCps = calcBaseCps();
      cps = baseCps * (1 + milkPct * 0.02);

      elements.score.textContent = format(cookies) + ' cookies';
      elements.cps.textContent = format(cps) + ' cookies/sec';
      elements.milk.textContent = `Milk: ${milkPct}% (+${(milkPct*2)}% CPS)`;

      buildings.forEach(b => {
        const btn = document.getElementById(b.id + 'Btn');
        if (btn) {
          btn.textContent = `${b.owned} ${b.name}${b.owned === 1 ? '' : 's'} - ${format(getCost(b))}`;
          btn.disabled = cookies < getCost(b);
        }
      });

      // Show available upgrades
      elements.upgradeShop.innerHTML = '';
      upgrades.forEach(upg => {
        if (!upg.bought && upg.req() && cookies >= upg.cost) {
          const btn = document.createElement('button');
          btn.className = 'upgrade-btn';
          btn.textContent = `${upg.icon} ${upg.name} - ${format(upg.cost)}`;
          btn.onclick = () => {
            if (cookies >= upg.cost) {
              cookies -= upg.cost;
              upg.bought = true;
              upg.effect();
              btn.remove();
              showNotification(`Upgrade Purchased: ${upg.name}!`);
            }
          };
          elements.upgradeShop.appendChild(btn);
        }
      });

      checkAchievements();
      saveGame();
    }

    function showNotification(text) {
      elements.achPopup.querySelector('.ach-inner').textContent = text;
      elements.achPopup.classList.add('show');
      setTimeout(() => elements.achPopup.classList.remove('show'), 4000);
    }

    function checkAchievements() {
      achievements.forEach(a => {
        if (!a.unlocked && a.condition()) {
          a.unlocked = true;
          showNotification(`Achievement: ${a.name}!`);
        }
      });
    }

    // Create building buttons
    buildings.forEach(b => {
      const btn = document.createElement('button');
      btn.id = b.id + 'Btn';
      elements.upgradesDiv.appendChild(btn);
      btn.addEventListener('click', () => {
        const cost = getCost(b);
        if (cookies >= cost) {
          cookies -= cost;
          b.owned++;
          update();
        }
      });
    });

    elements.cookie.addEventListener('click', () => {
      cookies += clickPower;
      manualClicks++;
      totalBaked += clickPower;
      update();
    });

    document.getElementById('statsBtn').onclick = () => document.getElementById('statsModal').style.display = 'flex';
    document.getElementById('reset').onclick = () => confirm('Wipe everything?') && (localStorage.removeItem('ccSaveV3'), location.reload());

    function loadGame() {
      const save = localStorage.getItem('ccSaveV3');
      if (save) {
        const data = JSON.parse(save);
        cookies = data.cookies || 0;
        totalBaked = data.totalBaked || 0;
        manualClicks = data.manualClicks || 0;
        clickPower = data.clickPower || 1;
        buildings.forEach((b, i) => b.owned = data.buildings?.[i]?.owned || 0);
        upgrades.forEach((u, i) => u.bought = data.upgrades?.[i]?.bought || false);
        achievements.forEach((a, i) => a.unlocked = data.achievements?.[i] || false);
      }
    }

    function saveGame() {
      const data = {
        cookies, totalBaked, manualClicks, clickPower,
        buildings: buildings.map(b => ({owned: b.owned})),
        upgrades: upgrades.map(u => ({bought: u.bought})),
        achievements: achievements.map(a => a.unlocked || false)
      };
      localStorage.setItem('ccSaveV3', JSON.stringify(data));
    }

    loadGame();
    update();

    function gameLoop() {
      const now = performance.now();
      const delta = (now - lastTime) / 1000;
      cookies += cps * delta;
      totalBaked += cps * delta;
      lastTime = now;
      update();
      requestAnimationFrame(gameLoop);
    }
    requestAnimationFrame(gameLoop);

    setInterval(saveGame, 10000);
  </script>
</body>
</html>
